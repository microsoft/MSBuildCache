steps:
- task: UseDotNet@2
  displayName: 'Install .NET $(DotNetVersion)'
  inputs:
    version: '$(DotNetVersion)'

- task: NuGetAuthenticate@1
  displayName: NuGet Authenticate

- displayName: Restore
  script: msbuild /t:restore $(Build.SourcesDirectory)/MSBuildCache.sln /bl:$(LogDirectory)/restore.binlog

- displayName: Build
  script: msbuild $(Build.SourcesDirectory)/MSBuildCache.sln /p:Configuration=$(BuildConfiguration) /bl:$(LogDirectory)/restore.binlog

- task: DotNetCoreCLI@2
  displayName: Run Unit Tests
  inputs:
    command: test
    projects: $(Build.SourcesDirectory)/MSBuildCache.sln
    arguments: -restore:false --no-build --configuration $(BuildConfiguration)

- publish: $(ArtifactsDirectory)
  displayName: Publish Artifacts
  artifact: artifacts
  condition: always()